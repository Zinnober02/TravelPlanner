# 旅游规划系统 - 系统架构设计文档

## 一、系统架构概述

### 1.1 整体架构

旅游规划系统采用前后端分离的架构设计，但部署时采用一体化部署，前端作为后端项目的Web资源。

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│    前端层       │     │    后端层       │     │    外部服务层   │
│ (Vue3 + Element │     │ (SpringBoot 3. │     │ (Supabase,     │
│  -Plus + Axios) │◄───►│ 5.7 + Java 21)  │◄───►│ AI服务等)       │
└─────────────────┘     └─────────────────┘     └─────────────────┘
```

### 1.2 技术栈详解

#### 1.2.1 前端技术栈
- **框架**: Vue3 组合式API
- **UI组件库**: Element-Plus
- **网络请求**: Axios
- **开发模式**: HTML中直接开发，非Vue脚手架项目

#### 1.2.2 后端技术栈
- **JDK版本**: 21
- **核心框架**: SpringBoot 3.5.7
- **工具库**: Lombok、SLF4J
- **HTTP客户端**: WebClient（用于调用Supabase REST API）
- **AI服务SDK**: dashscope-sdk-java 2.21.14（阿里云百炼）

#### 1.2.3 外部服务
- **数据库服务**: Supabase 云数据库（通过REST API访问）
- **AI服务**: 阿里云百炼 qwen-flash 模型
- **语音识别**: 科大讯飞语音识别API
- **地图服务**: 高德或百度地图API

## 二、系统分层设计

### 2.1 前端分层

```
┌─────────────────┐
│    页面组件层    │ (Vue组件，如Login.vue, Plan.vue等)
├─────────────────┤
│    API请求层     │ (集中管理所有Axios请求)
├─────────────────┤
│    工具函数层    │ (通用工具函数)
├─────────────────┤
│    状态管理       │ (简单的状态管理，可使用Vue的响应式数据)
└─────────────────┘
```

### 2.2 后端分层

```
┌─────────────────┐
│    Controller层  │ (处理HTTP请求，调用Service层)
├─────────────────┤
│    Service层     │ (业务逻辑处理)
├─────────────────┤
│    Repository层  │ (数据访问层，封装Supabase REST API调用)
├─────────────────┤
│    工具类层      │ (通用工具类，如HTTP客户端、AI服务客户端等)
├─────────────────┤
│    公共组件层    │ (全局异常处理器、统一响应格式等)
└─────────────────┘
```

## 三、核心模块设计

### 3.1 智能行程规划模块

#### 3.1.1 模块职责
- 接收用户输入（表单或自然语言）
- 调用AI服务生成行程规划
- 展示行程规划结果

#### 3.1.2 处理流程
```
用户输入 → 前端验证 → 后端处理 → 调用AI服务 → 解析结果 → 返回前端 → 展示
```

### 3.2 费用预算与管理模块

#### 3.2.1 模块职责
- 记录旅行开销
- 提供预算分析
- 支持语音录入

### 3.3 用户管理模块

#### 3.3.1 模块职责
- 用户注册与登录
- 管理用户信息
- 维护用户会话状态
- 管理多份旅行计划

## 四、关键机制设计

### 4.1 统一响应机制

采用统一的JSON格式返回API响应：
```json
{
  "code": 0,
  "message": "success",
  "data": {}
}
```

### 4.2 全局异常处理机制

使用Spring的全局异常处理器，统一处理各类异常，并返回标准化的错误响应。

### 4.3 用户认证机制

采用基于Session的认证机制，使用ThreadLocal保存当前登录用户信息。

### 4.4 数据访问机制

使用WebClient封装Supabase REST API调用，实现数据的增删改查操作。

## 五、部署架构

### 5.1 部署方式
前后端一体化部署，前端静态资源放置在SpringBoot项目的static目录下。

### 5.2 关键配置
- 端口配置
- 外部服务API密钥配置
- 日志配置

## 六、安全设计

### 6.1 认证与授权
- 用户密码加密存储
- 会话管理
- 访问控制

### 6.2 数据安全
- 敏感信息加密
- SQL注入防护（通过参数化查询）

### 6.3 传输安全
- HTTPS传输
- 请求头验证
